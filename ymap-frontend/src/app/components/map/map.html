<div class="relative w-full h-full">
  <!-- –ö–∞—Ä—Ç–∞ -->
  <div
    id="map"
    class="w-full h-[92vh] transition-all duration-300"
    [ngStyle]="{ filter: isDarkTheme ? 'grayscale(1)' : 'none' }"
  ></div>

  <!-- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É" -->
  <button
    class="absolute top-20 right-4 z-10 bg-blue-500 text-white px-4 py-2 btn shadow"
    (click)="openAddModalManually()"
  >
    –î–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É
  </button>

  <!-- –°–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫ ‚Äî –∫–Ω–æ–ø–∫–∞ -->
  <div class="absolute bottom-10 left-2 z-10">
    <button
      (click)="togglePointsList()"
      class="btn bg-white text-gray-800 px-4 py-2 rounded shadow transition"
    >
      {{ showPointsList ? '–°–∫—Ä—ã—Ç—å —Å–ø–∏—Å–æ–∫' : '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫' }}
    </button>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ —Ç–æ—á–µ–∫ -->
  <div
    *ngIf="showPointsList"
    class="absolute bottom-24 left-2 right-4 max-w-md max-h-60 overflow-y-auto bg-white dark:bg-gray-900 rounded-xl p-4 shadow-lg z-10 transition-all duration-500 ease-in-out"
  >
    <div
      *ngFor="let point of points"
      class="border-b border-gray-300 dark:border-gray-700 py-2"
    >
      <div class="text-sm font-medium text-gray-800 dark:text-gray-200">
        –ê–¥—Ä–µ—Å: {{ point.address || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' }}
      </div>
      <div class="text-xs text-gray-600 dark:text-gray-400">
        –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: {{ point.lat }}, {{ point.lng }}
      </div>
      <div class="mt-2 flex gap-2 items-center">
        <button
          (click)="focusOnPoint(point)"
          class="text-green-600 hover:underline text-sm"
        >
          üìç –ü–æ–∫–∞–∑–∞—Ç—å
        </button>
        <button
          *ngIf="point.user_id === currentUserId"
          (click)="editPoint(point)"
          class="text-blue-600 hover:underline text-sm"
        >
          –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
        </button>
        <button
          *ngIf="point.user_id === currentUserId"
          (click)="deletePoint(point)"
          class="text-red-600 hover:underline text-sm"
        >
          –£–¥–∞–ª–∏—Ç—å
        </button>
      </div>
    </div>
  </div>

  <!-- –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
  <div class="absolute bottom-10 right-2 z-10">
    <button
      class="btn bg-white text-gray-800 px-4 py-2 rounded shadow transition"
      (click)="toggleStats()"
    >
      {{ showStats ? '–°–∫—Ä—ã—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É' : '–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É' }}
    </button>
  </div>

  <!-- –ë–ª–æ–∫ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
  <div
    *ngIf="showStats"
    class="absolute bottom-24 right-2 max-w-md max-h-60 overflow-y-auto bg-white dark:bg-gray-900 rounded-xl p-4 shadow-lg z-10 transition-all duration-500 ease-in-out"
  >
    <div
      *ngFor="let s of statsList"
      class="py-1 text-sm text-gray-800 dark:text-gray-200 max-w-md max-h-60 overflow-y-auto"
    >
      üë§ {{ s.username }} ‚Äî {{ s.count }} —Ç–æ—á{{ s.count === 1 ? '–∫–∞' : s.count <
      5 ? '–∫–∏' : '–µ–∫' }}
    </div>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ—á–∫–∏ -->
  <app-add-point
    *ngIf="showAddModal"
    [coords]="newPointCoords"
    [pointId]="editingPointId"
    [existingName]="editingPointName"
    [existingDescription]="editingPointDescription"
    (cancel)="onCancelAdd()"
    (pointAdded)="onPointAdded()"
  ></app-add-point>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
  <app-message-modal
    *ngIf="showAuthModal"
    [title]="'–¢—Ä–µ–±—É–µ—Ç—Å—è –≤—Ö–æ–¥'"
    [message]="'–°–Ω–∞—á–∞–ª–∞ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ—á–∫—É.'"
    (confirm)="showAuthModal = false"
  ></app-message-modal>

  <!-- –ú–æ–¥–∞–ª–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
  <app-message-modal
    *ngIf="showDeleteModal"
    [title]="'–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è'"
    [message]="'–£–¥–∞–ª–∏—Ç—å —ç—Ç—É —Ç–æ—á–∫—É?'"
    [showCancel]="true"
    (confirm)="confirmDelete()"
    (cancel)="cancelDelete()"
  ></app-message-modal>

  <!-- –õ–æ–∞–¥–µ—Ä -->
  <div
    *ngIf="isLoading"
    class="absolute inset-0 z-50 bg-white/80 dark:bg-gray-900/80 flex items-center justify-center"
  >
    <div
      class="loader w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"
    ></div>
  </div>
</div>
